# .github/workflows/deploy.yml
name: Deploy para GitHub Pages

# Dispara a action sempre que houver um push na branch principal (main ou master)
on:
  push:
    branches:
      - main  # Altere para 'master' se for a branch principal do seu repositório

# Define permissões para a action poder criar o deploy (necessário a partir de 2024)
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    # Usa a versão mais recente do Ubuntu
    runs-on: ubuntu-latest
    
    # Define o ambiente de deploy (opcional, mas recomendado pelo GitHub Pages)
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      # 1. Checkout do Código
      - name: Checkout do Repositório
        uses: actions/checkout@v4
        
      # 2. Configurar Node.js (Ambiente de desenvolvimento)
      - name: Configurar Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Versão recomendada para projetos Node/TS atuais
          cache: 'npm'
          
      # 3. Instalar Dependências NPM
      - name: Instalar dependências
        run: npm install

      # 4. Executar o Build (tsc && vite build)
      # O script 'build' definido no seu package.json (tsc && vite build)
      - name: Construir o projeto com Vite
        run: npm run build
        
      # 5. Configurar o Artefato de Deploy
      # Cria o artefato 'github-pages' a partir da pasta 'dist' gerada pelo Vite.
      - name: Configurar Artefato GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          # A pasta de saída do seu build (definida no vite.config.ts)
          path: './dist' 

      # 6. Deploy no GitHub Pages
      - name: Fazer Deploy no GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        # Não precisa de 'with' pois o 'upload-pages-artifact' já configurou o artefato.